<?php
session_start();

// Simple authentication for the demo (replace with more secure methods for production)
if (!isset($_SESSION['authenticated'])) {
    header("Location: login.php");
    exit();
}

// Check if the user has submitted a URL
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    // Validate URL: Only allow certain domains (e.g., "tadericson.com")
    $url = filter_var($_POST['url'], FILTER_VALIDATE_URL);
    
    // Check if the URL is valid and contains the domain we want to allow
    if ($url && preg_match('/^https?:\/\/(www\.)?tadericson\.com\//', $url)) {
        
        // Sanitize and escape shell command to prevent command injection
        $escaped_url = escapeshellarg($url);
        $command = "wget -r -np -k $escaped_url"; 
        
        // Run the command and capture the output
        $output = shell_exec($command);
        
        // Log the action for monitoring (This is basic; consider using more robust logging in production)
        file_put_contents('logs/command_log.txt', date('Y-m-d H:i:s') . " - Command: $command\n", FILE_APPEND);

        echo "<pre>$output</pre>";
    } else {
        echo "Invalid URL or domain! Only URLs from 'tadericson.com' are allowed.";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Online Terminal</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        textarea { width: 100%; height: 150px; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <h1>Secure Online Terminal for wget</h1>
    <form method="POST">
        <label for="url">Enter URL to download (Only URLs from "tadericson.com" allowed):</label><br>
        <input type="text" name="url" id="url" required placeholder="https://www.tadericson.com/"><br><br>
        <button type="submit">Run wget</button>
    </form>

    <?php if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($output)): ?>
        <h2>Output:</h2>
        <pre><?php echo htmlspecialchars($output); ?></pre>
    <?php endif; ?>
</body>
<footer>
  <iframe src="https://yourwebsite.com/wget-terminal.php" width="800" height="600"></iframe>
</footer>  
</html>
